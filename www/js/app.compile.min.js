(function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e})()({1:[function(require,module,exports){
"use strict";angular.module("settings",[]).constant("config",{main_path:"/",spinalhub_url:"127.0.0.1",spinalhub_port:"8888",spinalhub_user:"168"});

},{}],2:[function(require,module,exports){
"use strict";angular.module("app.route",["ngRoute"]),angular.module("app.services",[]),angular.module("app.directives",[]),angular.module("app.controllers",[]),angular.module("app.spinalcom",["settings","ngMaterial"]),angular.module("app.spinalforge.plugin",[]),angular.module("SpinalApp",["ngAnimate","ngMaterial","app.directives","app.route","app.services","app.controllers","ngMdIcons","settings","app.spinalcom","app.spinalforge.plugin","colorpicker.module"]).run(["$rootScope","$location","authService",function(e,a,t){var n=t.get_user();e.$on("$routeChangeStart",function(e,o,r){o.$$route.authenticate&&(t.is_Connected()||t.login(n.username,n.password).then(function(){},function(){a.path("/login")}))})}]).config(["$mdThemingProvider",function(e){e.theme("altTheme").primaryPalette("grey",{default:"200"}).accentPalette("grey",{default:"700"}).dark(),e.theme("default").dark(),e.setDefaultTheme("altTheme"),e.alwaysWatchTheme(!0)}]).run(["$templateCache","$http",function(e,a){for(var t=function(t,n){a.get(t).then(function(a){e.put(n,a.data)},function(e){console.log("Cannot load the file "+t)})},n=[{uri:"app/templates/forgeviewer.html",name:"forgeviewer.html"}],o=0;o<n.length;o++)t(n[o].uri,n[o].name)}]);

},{}],3:[function(require,module,exports){
"use strict";angular.module("app.route").config(["$routeProvider","$locationProvider",function(e,t){e.when("/viewer/:filepath",{templateUrl:"app/templates/main.html",authenticate:!0,controller:"mainCtrl"}).when("/login",{templateUrl:"app/templates/login.html",authenticate:!1,controller:"loginCtrl"}).when("/404",{authenticate:!1,controller:["$location",function(e){e.replace("/drive/")}]}).otherwise({redirectTo:"/404"})}]);

},{}],4:[function(require,module,exports){
"use strict";angular.module("app.spinalforge.plugin").controller("forgeViewerCtrl",["$scope","$rootScope","$mdDialog","authService","$compile","$injector","layout_uid","spinalModelDictionary","spinalRegisterViewerPlugin",function(e,i,o,n,t,a,r,d,l){e.injector=a,e.uid=r.get(),i.allNotes=[],d.init().then(function(i){var o,n={inViewerSearchConfig:{uiEnabled:!0,clientId:"dsadsa",sessionId:"F969EB70-242F-11E6-BDF4-0800200C9A66",loadedModelTab:{enabled:!0,displayName:"This View",pageSize:50},relatedItemsTab:{enabled:!0,displayName:"This Item",pageSize:20}}};l.register("Autodesk.ADN.Viewing.Extension.Color");var t,a={env:"Local",docid:""};i.urn.get();if(0!=(t=i._children.get()).length){for(var r=t[0].path,d=0;d<t.length;d++)if(/.+\.svf$/.test(t[d].path)){r=t[d].path;break}r=window.location.origin+r,a.docid=r}function onDocumentLoadFailure(e){console.error("onDocumentLoadFailure() - errorCode:"+e)}function onItemLoadSuccess(i,n){i.scope=e,o.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,function onGeometryLoadEvent(){o.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,onGeometryLoadEvent);for(var e=l.get(),i=0;i<e.length;i++)o.loadExtension(e[i],a)})}o=new Autodesk.Viewing.Private.GuiViewer3D($("#MyViewerDiv"+e.uid)[0],n),Autodesk.Viewing.Initializer(a,function(){o.initialize(),console.log(a.docid),o.loadModel(a.docid,n,onItemLoadSuccess,onDocumentLoadFailure),e.oviewer=o})})}]);

},{}],5:[function(require,module,exports){
"use strict";angular.module("app.controllers").controller("loginCtrl",["$scope","authService","$mdToast","$location",function(o,n,t,e){var l=t.simple().hideDelay(3e3);n.get_user();n.logout(),o.conf={email:"",password:""},o.ConnectBtn=function(){n.login(o.conf.email,o.conf.password).then(function(){e.path("/home")},function(o){l.textContent(o),t.show(l)})}}]);

},{}],6:[function(require,module,exports){
"use strict";angular.module("app.controllers").controller("mainCtrl",["$scope","$routeParams","goldenLayoutService","spinalModelDictionary",function(o,r,e,l){e.init()}]);

},{}],7:[function(require,module,exports){
"use strict";angular.module("app.controllers").controller("navbarCtrl",["$scope","authService","$location","$routeParams",function(e,t,o,n){e.username="",e.connected=!1,t.wait_connect().then(function(){e.username=t.get_user().username,e.connected=!0,e.viewer=n.filepath,e.viewer?e.viewer=atob(e.viewer):e.viewer="viewer",console.log(n.filepath)}),e.logout=function(){o.path("/login")},e.layouts=[{id:"drag-viewer",name:"viewer",cfg:{isClosable:!0,title:"viewer",type:"component",componentName:"SpinalHome",componentState:{template:"forgeviewer.html",controller:"forgeViewerCtrl"}}}]}]);

},{}],8:[function(require,module,exports){
"use strict";angular.module("app.directives").directive("navbar",[function(){return{restrict:"E",templateUrl:"app/templates/navbar.html",controller:"navbarCtrl"}}]).directive("menuGlayout",["goldenLayoutService","$timeout",function(t,e){return{restrict:"E",scope:{layoutInfo:"=info"},replace:!0,template:'<li ng-repeat="layout in layoutInfo"  id="{{layout.id}}"><a >{{layout.name}}</a></li>',link:function(e,n,i){t.wait_ready().then(function(){for(var n=function(t,e){return function(){t.createChild(e.cfg)}},i=0;i<e.layoutInfo.length;i++){var r=e.layoutInfo[i];t.createDragSource($("#"+r.id)[0],r.cfg),$("#"+r.id).click(n(t,r))}})}}}]).directive("ngRightClick",["$parse",function(t){return function(e,n,i){var r=t(i.ngRightClick);n.bind("contextmenu",function(t){e.$apply(function(){t.preventDefault(),r(e,{$event:t})})})}}]);

},{}],9:[function(require,module,exports){
(function(e){"use strict";var t=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=angular.module("app.spinalforge.plugin");n.run(["$rootScope","$compile","$templateCache","$http","spinalRegisterViewerPlugin",function(e,n,o,i,l){for(var a=function(e,t){i.get(e).then(function(e){o.put(t,e.data)},function(t){console.log("Cannot load the file "+e)})},r=[{uri:"app/templates/annotationTemplate.html",name:"annotationTemplate.html"}],s=0;s<r.length;s++)a(r[s].uri,r[s].name);var c=function(){function PannelAnnotation(e,t){_classCallCheck(this,PannelAnnotation),Autodesk.Viewing.Extension.call(this,e,t),this.viewer=e,this.panel=null}return t(PannelAnnotation,[{key:"load",value:function(){return this.viewer.toolbar?this.createUI():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),this.viewer.addEventListener(av.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded)),!0}},{key:"onToolbarCreated",value:function(){this.viewer.removeEventListener(av.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null,this.createUI()}},{key:"unload",value:function(){return this.viewer.toolbar.removeControl(this.subToolbar),!0}},{key:"createUI",value:function(){var e=this;this.panel=new PanelClass(this.viewer,"Annotation");var t=new Autodesk.Viewing.UI.Button("Annotation");t.onClick=function(t){e.panel.isVisible()?e.panel.setVisible(!1):e.panel.setVisible(!0)},t.addClass("fa"),t.addClass("fa-pencil"),t.addClass("fa-2x"),t.setToolTip("Annotation"),this.subToolbar=this.viewer.toolbar.getControl("my-Annotation"),this.subToolbar||(this.subToolbar=new Autodesk.Viewing.UI.ControlGroup("my-Annotation"),this.viewer.toolbar.addControl(this.subToolbar)),this.subToolbar.addControl(t),this.initialize()}},{key:"initialize",value:function(){var t=document.createElement("div");t.style.height="calc(100% - 45px)",t.style.overflowY="auto",this.panel.container.appendChild(t),$(t).html('<div ng-controller="annotationCtrl" ng-cloak>'+o.get("annotationTemplate.html")+"</div>"),n($(t).contents())(e)}}]),PannelAnnotation}();Autodesk.Viewing.theExtensionManager.registerExtension("PannelAnnotation",c)}]).controller("annotationCtrl",["$scope","$rootScope","$mdDialog","authService","$compile","$injector","layout_uid","spinalModelDictionary","$q",function(e,t,n,o,i,l,a,r,s){e.headerBtnClick=function(e){console.log("headerBtnClick"),console.log(e)},e.headerBtn=[{label:"add note",icon:"note_add"},{label:"visibility",icon:"visibility",toggleIcon:""},{label:"visibility cancel",icon:"visibility_off"}],e.currentVisibleObj=[],e.notes=[],r.init().then(function(t){t&&(t.annotationPlugin?t.annotationPlugin.load(function(t){e.noteListModel=t,e.noteListModel.bind(e.onModelChange)}):(e.noteListModel=new Lst,t.add_attr({annotationPlugin:new Ptr(e.noteListModel)}),e.noteListModel.bind(e.onModelChange)))}),e.waitObjRdy=function(e){var t=s.defer();return function(e,t){FileSystem._tmp_objects[e._server_id]?setTimeout(function(){deferObjChange(e,t)},200):t.resolve(e)}(e,t),t.promise},e.onModelChange=function(){e.notes=[];for(var t=[],n=0;n<e.noteListModel.length;n++){var o=e.noteListModel[n];t.push(e.waitObjRdy(o))}s.all(t).then(function(t){e.notes=[];for(var n=0;n<e.noteListModel.length;n++){var o=e.noteListModel[n],i=o.get();i._server_id=o._server_id,e.notes.push(i),e.selectedNote&&e.selectedNote._server_id==i._server_id&&(e.selectedNote=i),console.log(e.oviewer)}})},e.$on("colorpicker-closed",function(){for(var t=0;t<e.notes.length;t++){var n=e.notes[t],o=FileSystem._objects[n._server_id];o&&o.color.get()!==n.color&&o.color.set(n.color)}}),e.selectedNote=null,e.selectedStyle=function(t){return t===e.selectedNote?"background-color: #4185f4":""},e.getViewIcon=function(e){return e.view?"visibility":"visibility_off"},e.selectNote=function(t){e.selectedNote=t},e.renameNote=function(e){n.show(n.prompt().title("Rename Note").placeholder("Please enter the title").ariaLabel("Rename Note").clickOutsideToClose(!0).required(!0).ok("Confirm").cancel("Cancel")).then(function(t){var n=FileSystem._objects[e._server_id];n&&n.title.set(t)},function(){})},e.toggleViewNote=function(e){e.view=!e.view},e.addModelInNote=function(e){},e.deleteNote=function(e){},e.chatNote=function(e){}}]),e._createClass=t,e._classCallCheck=_classCallCheck,e.appSpinalforgePlugin=n}).call(window,window);

},{}],10:[function(require,module,exports){
"use strict";angular.module("app.spinalcom").factory("authService",["$q","ngSpinalCore","config","$http",function(e,r,n,t){var o={},a={username:"",password:"",id:""},s=!1;o.save_user=function(e,r,n){a.username=e,a.password=r,a.id=n,window.localStorage.setItem("spinalhome_cfg",btoa(JSON.stringify(a)))},o.get_user=function(){var e=window.localStorage.getItem("spinalhome_cfg");return e&&(a=JSON.parse(atob(e))),a},o.logout=function(e,r){""!=a.username&&(o.save_user("","",""),location.reload())},o.login=function(a,u){var c=e.defer();return t.get("/get_user_id?u="+a+"&p="+u).then(function(e){var t=parseInt(e.data),l=0;if(-1!=t){for(r.connect("http://"+t+":"+u+"@"+n.spinalhub_url+":"+n.spinalhub_port+"/"),o.save_user(a,u,t),s=!0,c.resolve(),l=0;l<i.length;l++)i[l].resolve();i=[]}else{for(c.reject("Login Error: username / password pair not found."),l=0;l<i.length;l++)i[l].reject();i=[]}},function(e){c.reject("Connection Error: Imposible to connect to the server.");for(var r=0;r<i.length;r++)i[r].reject();i=[]}),c.promise},o.is_Connected=function(){return s};var i=[];return o.wait_connect=function(){var r=e.defer();return 1==s?r.resolve():i.push(r),r.promise},o}]);

},{}],11:[function(require,module,exports){
"use strict";angular.module("app.services").factory("goldenLayoutService",["$q","$window","$templateCache","$rootScope","$compile",function(e,t,n,o,r){var i={content:[{type:"row",content:[{isClosable:!1,title:"Viewer",type:"component",componentName:"SpinalHome",componentState:{template:"forgeviewer.html",controller:"forgeViewerCtrl"}}]}]},a=0,c={init:function(){0==a&&((a=new GoldenLayout(i,$("#g-layout"))).registerComponent("SpinalHome",function(e,t){var i=e.getElement();""==t.template?(i.html(),r(i.contents())(o)):(i.html('<div class="gpannel-content" ng-controller="'+t.controller+'" ng-cloak>'+n.get(t.template)+"</div>"),r(i.contents())(o))}),a.init(),angular.element(t).bind("resize",function(){a.updateSize()}),o.$emit("GoldenLayout_READY"))},wait_ready:function(){return e(function(e,t){o.$on("GoldenLayout_READY",function(){e()})})},createChild:function(e){a.root.contentItems[0].addChild(e)},createDragSource:function(e,t){a.createDragSource(e,t)}};return c}]).factory("layout_uid",function(){var e=0;return{get:function(){return e++}}}).factory("spinalRegisterViewerPlugin",function(){var e=[];return{get:function(){return e},register:function(t){for(var n=0;n<e.length;n++)if(e[n]===t)return;e.push(t)}}});

},{}],12:[function(require,module,exports){
"use strict";angular.module("app.spinalcom").factory("ngSpinalCore",["$q",function(n){var e={conn:0,connect:function(n){e.conn=spinalCore.connect(n)},store:function(o,r){var t=n.defer();return spinalCore.store(e.conn,o,r,function(n){t.resolve(n)},function(){t.reject()}),t.promise},load:function(o){var r=n.defer();return spinalCore.load(e.conn,o,function(n){r.resolve(n)},function(){r.reject()}),r.promise},load_type:function(o,r){var t=n.defer();return spinalCore.load_type(e.conn,o,r,function(n){t.resolve(n)},function(){t.reject()}),t.promise},load_right:function(o){var r=n.defer();return spinalCore.load_right(e.conn,o,function(n){r.resolve(n)},function(){r.reject()}),r.promise},share_model:function(n,o,r,t){return spinalCore.share_model(e.conn,n,o,r,t)}};return e}]);

},{}],13:[function(require,module,exports){
"use strict";angular.module("app.spinalcom").factory("spinalModelDictionary",["$q","ngSpinalCore","config","authService","$routeParams","$location",function(e,o,r,n,t,a){var l={model:0,init:function(){var r=e.defer();return 0==l.model?n.wait_connect().then(function(){n.get_user();var e=t.filepath;console.log(e),e&&(e=atob(e),o.load(e).then(function(e){l.model=e,console.log(e),r.resolve(e)},function(){var o="not able to load : "+e;console.error(o),a.replace("/drive/"),r.reject(o)}))},function(){var e="not able to load : "+path;console.error(e),a.replace("/drive/"),r.reject(e)}):r.resolve(l.model),r.promise}};return l}]);

},{}]},{},[2,1,3,8,12,13,11,10,6,7,4,5,9])
//# sourceMappingURL=app.compile.min.js.map
